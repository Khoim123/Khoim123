-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

-- Load Fluent Library
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

-- Variables
local player = Players.LocalPlayer
local character
local AimbotDistance = 50
local Smoothness = 0.5
local CharacterTilt = false
local AimbotEnabled = false
local SelectedPlayers = {}
local aimbotConnection

-- Character Management
local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

task.spawn(function()
    character = getCharacter()
    player.CharacterAdded:Connect(function(newChar)
        character = newChar
        task.wait(0.5)
    end)
end)

-- Core Functions
local function calculateDistance(pos1, pos2)
    return (pos1 - pos2).Magnitude
end

local function isValidTarget(targetPlayer)
    if not targetPlayer or targetPlayer == player then return false end
    return next(SelectedPlayers) == nil or SelectedPlayers[targetPlayer.UserId]
end

local function getNearestCharacter()
    if not AimbotEnabled or not character then return nil end
    
    local playerRoot = character:FindFirstChild("HumanoidRootPart")
    if not playerRoot then return nil end
    
    local closestChar, shortestDist = nil, math.huge
    
    for _, targetPlayer in ipairs(Players:GetPlayers()) do
        if isValidTarget(targetPlayer) and targetPlayer.Character then
            local targetChar = targetPlayer.Character
            local humanoid = targetChar:FindFirstChild("Humanoid")
            local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
            
            if targetRoot and humanoid and humanoid.Health > 0 then
                local dist = calculateDistance(playerRoot.Position, targetRoot.Position)
                if dist < shortestDist and dist <= AimbotDistance then
                    shortestDist = dist
                    closestChar = targetChar
                end
            end
        end
    end
    
    return closestChar
end

local function aimAtTarget(target)
    if not character then return end
    
    local playerRoot = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 or not playerRoot then return end
    
    local targetRoot = target:FindFirstChild("HumanoidRootPart")
    if not targetRoot then return end
    
    local targetPos = targetRoot.Position
    local direction = CharacterTilt and (targetPos - playerRoot.Position).Unit 
        or Vector3.new(targetPos.X - playerRoot.Position.X, 0, targetPos.Z - playerRoot.Position.Z).Unit
    
    local smoothedDir = playerRoot.CFrame.LookVector:Lerp(direction, Smoothness)
    playerRoot.CFrame = CFrame.new(playerRoot.Position, playerRoot.Position + smoothedDir)
end

local function toggleAimbot(state)
    AimbotEnabled = state
    
    if aimbotConnection then
        aimbotConnection:Disconnect()
        aimbotConnection = nil
    end
    
    if state then
        aimbotConnection = RunService.Heartbeat:Connect(function()
            pcall(function()
                if character and character:FindFirstChild("HumanoidRootPart") then
                    local humanoid = character:FindFirstChild("Humanoid")
                    if humanoid and humanoid.Health > 0 then
                        local nearestChar = getNearestCharacter()
                        if nearestChar then
                            aimAtTarget(nearestChar)
                        end
                    end
                end
            end)
        end)
    end
end

-- Create Fluent Window
local Window = Fluent:CreateWindow({
    Title = "Aimbot Pro",
    SubTitle = "Mobile Optimized",
    TabWidth = 160,
    Size = UDim2.fromOffset(520, 420),
    Acrylic = true,
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Aimbot", Icon = "crosshair" }),
    Players = Window:AddTab({ Title = "Ng∆∞·ªùi ch∆°i", Icon = "users" }),
    Settings = Window:AddTab({ Title = "C√†i ƒë·∫∑t", Icon = "settings" })
}

-- Main Tab
local MainSection = Tabs.Main:AddSection("ƒêi·ªÅu khi·ªÉn Aimbot")

local AimbotToggle = Tabs.Main:AddToggle("AimbotEnabled", {
    Title = "B·∫≠t Aimbot",
    Description = "K√≠ch ho·∫°t/T·∫Øt aimbot",
    Default = false,
    Callback = function(value)
        toggleAimbot(value)
        Fluent:Notify({
            Title = "Aimbot",
            Content = value and "ƒê√£ B·∫¨T aimbot" or "ƒê√£ T·∫ÆT aimbot",
            Duration = 2
        })
    end
})

local DistanceSlider = Tabs.Main:AddSlider("AimbotDistance", {
    Title = "Kho·∫£ng c√°ch ng·∫Øm",
    Description = "T·∫ßm xa t·ªëi ƒëa (studs)",
    Default = 50,
    Min = 1,
    Max = 10000,
    Rounding = 0,
    Callback = function(value)
        AimbotDistance = value
    end
})

local SmoothnessSlider = Tabs.Main:AddSlider("Smoothness", {
    Title = "ƒê·ªô m∆∞·ª£t",
    Description = "T·ªëc ƒë·ªô xoay camera",
    Default = 0.5,
    Min = 0.1,
    Max = 1,
    Rounding = 2,
    Callback = function(value)
        Smoothness = value
    end
})

local TiltToggle = Tabs.Main:AddToggle("CharacterTilt", {
    Title = "Ng·∫Øm theo chi·ªÅu d·ªçc",
    Description = "B·∫≠t ƒë·ªÉ ng·∫Øm c·∫£ tr·ª•c Y",
    Default = false,
    Callback = function(value)
        CharacterTilt = value
    end
})

Tabs.Main:AddParagraph({
    Title = "Tr·∫°ng th√°i",
    Content = "Aimbot s·∫µn s√†ng s·ª≠ d·ª•ng"
})

-- Players Tab
local PlayersSection = Tabs.Players:AddSection("Qu·∫£n l√Ω m·ª•c ti√™u")

local PlayerList = Tabs.Players:AddParagraph({
    Title = "Danh s√°ch ng∆∞·ªùi ch∆°i",
    Content = "ƒêang t·∫£i..."
})

local function updatePlayerList()
    local playerCount = 0
    local selectedCount = 0
    
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player then
            playerCount = playerCount + 1
            if SelectedPlayers[p.UserId] then
                selectedCount = selectedCount + 1
            end
        end
    end
    
    local content = string.format(
        "T·ªïng s·ªë: %d ng∆∞·ªùi\nƒê√£ ch·ªçn: %d ng∆∞·ªùi\n\n%s",
        playerCount,
        selectedCount,
        selectedCount == 0 and "Ng·∫Øm t·∫•t c·∫£ ng∆∞·ªùi ch∆°i" or "Ch·ªâ ng·∫Øm ng∆∞·ªùi ƒë∆∞·ª£c ch·ªçn"
    )
    
    PlayerList:SetDesc(content)
end

Tabs.Players:AddButton({
    Title = "L√†m m·ªõi danh s√°ch",
    Description = "C·∫≠p nh·∫≠t danh s√°ch ng∆∞·ªùi ch∆°i",
    Callback = function()
        updatePlayerList()
        Fluent:Notify({
            Title = "L√†m m·ªõi",
            Content = "ƒê√£ c·∫≠p nh·∫≠t danh s√°ch ng∆∞·ªùi ch∆°i",
            Duration = 2
        })
    end
})

Tabs.Players:AddButton({
    Title = "B·ªè ch·ªçn t·∫•t c·∫£",
    Description = "X√≥a t·∫•t c·∫£ m·ª•c ti√™u ƒë√£ ch·ªçn",
    Callback = function()
        SelectedPlayers = {}
        updatePlayerList()
        Fluent:Notify({
            Title = "ƒê√£ x√≥a",
            Content = "B·ªè ch·ªçn t·∫•t c·∫£ ng∆∞·ªùi ch∆°i",
            Duration = 2
        })
    end
})

local PlayerDropdown = Tabs.Players:AddDropdown("PlayerSelector", {
    Title = "Ch·ªçn m·ª•c ti√™u",
    Description = "Ch·ªçn ng∆∞·ªùi ch∆°i ƒë·ªÉ nh·∫Øm ƒë·∫øn",
    Values = {},
    Multi = true,
    Default = {},
    Callback = function(values)
        SelectedPlayers = {}
        for playerName, selected in pairs(values) do
            if selected then
                for _, p in ipairs(Players:GetPlayers()) do
                    if p.Name == playerName then
                        SelectedPlayers[p.UserId] = true
                        break
                    end
                end
            end
        end
        updatePlayerList()
    end
})

local function refreshPlayerDropdown()
    local playerNames = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player then
            table.insert(playerNames, p.Name)
        end
    end
    PlayerDropdown:SetValues(playerNames)
end

-- Settings Tab
local SettingsSection = Tabs.Settings:AddSection("C·∫•u h√¨nh")

Tabs.Settings:AddButton({
    Title = "Reset v·ªÅ m·∫∑c ƒë·ªãnh",
    Description = "ƒê·∫∑t l·∫°i t·∫•t c·∫£ c√†i ƒë·∫∑t",
    Callback = function()
        DistanceSlider:SetValue(50)
        SmoothnessSlider:SetValue(0.5)
        TiltToggle:SetValue(false)
        AimbotToggle:SetValue(false)
        SelectedPlayers = {}
        updatePlayerList()
        Fluent:Notify({
            Title = "Reset",
            Content = "ƒê√£ ƒë·∫∑t l·∫°i t·∫•t c·∫£ c√†i ƒë·∫∑t",
            Duration = 3
        })
    end
})

Tabs.Settings:AddParagraph({
    Title = "Th√¥ng tin",
    Content = "Phi√™n b·∫£n: 2.0\nT·ªëi ∆∞u cho Mobile\nH·ªó tr·ª£ Fluent UI"
})

-- Create Toggle Button (Always Visible)
local ToggleButton = Instance.new("ScreenGui")
ToggleButton.Name = "AimbotToggle"
ToggleButton.ResetOnSpawn = false
ToggleButton.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

if gethui then
    ToggleButton.Parent = gethui()
elseif syn and syn.protect_gui then
    syn.protect_gui(ToggleButton)
    ToggleButton.Parent = CoreGui
else
    ToggleButton.Parent = CoreGui
end

local ToggleFrame = Instance.new("Frame")
ToggleFrame.Size = UDim2.new(0, 55, 0, 55)
ToggleFrame.Position = UDim2.new(0, 15, 0.5, -27)
ToggleFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ToggleFrame.BorderSizePixel = 0
ToggleFrame.Parent = ToggleButton

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = ToggleFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(100, 100, 100)
UIStroke.Thickness = 2
UIStroke.Parent = ToggleFrame

local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(1, 0, 1, 0)
ToggleBtn.BackgroundTransparency = 1
ToggleBtn.Text = "üéØ"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.TextSize = 26
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Parent = ToggleFrame

-- Dragging
local dragging, dragInput, dragStart, startPos

ToggleFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = ToggleFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

ToggleFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        ToggleFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Toggle Click
local guiVisible = true
ToggleBtn.MouseButton1Click:Connect(function()
    guiVisible = not guiVisible
    Window:Minimize()
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(ToggleFrame, tweenInfo, {
        BackgroundColor3 = guiVisible and Color3.fromRGB(40, 40, 40) or Color3.fromRGB(60, 60, 60)
    })
    tween:Play()
end)

-- Auto Update Player List
Players.PlayerAdded:Connect(function()
    task.wait(0.5)
    refreshPlayerDropdown()
    updatePlayerList()
end)

Players.PlayerRemoving:Connect(function(leftPlayer)
    SelectedPlayers[leftPlayer.UserId] = nil
    refreshPlayerDropdown()
    updatePlayerList()
end)

-- Initialize
refreshPlayerDropdown()
updatePlayerList()

Fluent:Notify({
    Title = "Aimbot Pro",
    Content = "GUI ƒë√£ t·∫£i th√†nh c√¥ng!",
    Duration = 4
})

warn("‚úÖ Fluent Aimbot GUI loaded!")
print("Features: Optimized code, Fluent UI, Mobile support")