local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local PLACE_ID = game.PlaceId

-- ScreenGui
local gui = Instance.new("ScreenGui", Players.LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "ServerBrowserGui"

-- Main Frame
local frame = Instance.new("Frame", gui)
frame.Name = "MainFrame"
frame.Size = UDim2.new(0, 400, 0, 300)
frame.Position = UDim2.new(0.5, -200, 0.5, -150)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.BackgroundTransparency = 0.05
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 16)

-- Title Label
local title = Instance.new("TextLabel", frame)
title.Text = "üñß Tr√¨nh duy·ªát Server"
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Info Label
local info = Instance.new("TextLabel", frame)
info.Position = UDim2.new(0, 10, 0, 50)
info.Size = UDim2.new(1, -20, 1, -130)
info.BackgroundTransparency = 1
info.Font = Enum.Font.Gotham
info.TextSize = 14
info.TextColor3 = Color3.fromRGB(255, 255, 255)
info.TextWrapped = true
info.TextXAlignment = Enum.TextXAlignment.Left
info.TextYAlignment = Enum.TextYAlignment.Top
info.Text = "ƒêang t·∫£i..."

-- Refresh Button
local refreshBtn = Instance.new("TextButton", frame)
refreshBtn.Size = UDim2.new(0, 130, 0, 35)
refreshBtn.Position = UDim2.new(0, 10, 0, 10)
refreshBtn.Text = "üîÑ L√†m m·ªõi"
refreshBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
refreshBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
refreshBtn.Font = Enum.Font.GothamBold
refreshBtn.TextSize = 14
Instance.new("UICorner", refreshBtn).CornerRadius = UDim.new(0, 10)

-- Server √≠t ng∆∞·ªùi
local lowPopBtn = Instance.new("TextButton", frame)
lowPopBtn.Size = UDim2.new(0, 180, 0, 35)
lowPopBtn.Position = UDim2.new(0, 10, 1, -45)
lowPopBtn.Text = "üë• V√†o server √≠t ng∆∞·ªùi"
lowPopBtn.BackgroundColor3 = Color3.fromRGB(30, 150, 30)
lowPopBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
lowPopBtn.Font = Enum.Font.GothamBold
lowPopBtn.TextSize = 14
Instance.new("UICorner", lowPopBtn).CornerRadius = UDim.new(0, 10)

-- Server ping th·∫•p
local lowPingBtn = Instance.new("TextButton", frame)
lowPingBtn.Size = UDim2.new(0, 180, 0, 35)
lowPingBtn.Position = UDim2.new(1, -190, 1, -45)
lowPingBtn.Text = "üì∂ V√†o server ping th·∫•p"
lowPingBtn.BackgroundColor3 = Color3.fromRGB(200, 150, 0)
lowPingBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
lowPingBtn.Font = Enum.Font.GothamBold
lowPingBtn.TextSize = 14
Instance.new("UICorner", lowPingBtn).CornerRadius = UDim.new(0, 10)

-- Toggle GUI Button
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0, 130, 0, 35)
toggleBtn.Position = UDim2.new(0, 20, 0, 20)
toggleBtn.Text = "üëÅÔ∏è ·∫®n/Hi·ªán GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

-- Toggle GUI Logic
toggleBtn.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

-- H√†m t√¨m server
local function findBestServer(mode)
	info.Text = "ƒêang t√¨m server..."
	local cursor, best, value = "", nil, math.huge
	while true do
		local url = string.format("https://games.roblox.com/v1/games/%d/servers/Public?limit=100&sortOrder=Asc&cursor=%s", PLACE_ID, cursor)
		local success, result = pcall(function()
			return HttpService:JSONDecode(game:HttpGet(url))
		end)
		if not success or not result or not result.data then
			info.Text = "L·ªói t·∫£i danh s√°ch server."
			return nil
		end
		for _, server in ipairs(result.data) do
			if server.id ~= game.JobId then
				local comp = (mode == "lowpop") and server.playing or (server.ping or math.huge)
				if comp < value then
					value = comp
					best = server
				end
			end
		end
		if result.nextPageCursor then
			cursor = result.nextPageCursor
		else
			break
		end
	end
	if best then
		info.Text = string.format("üë• %d ng∆∞·ªùi | ID: %s | üì∂ Ping: %s", best.playing, best.id, best.ping or "kh√¥ng r√µ")
		return best.id
	else
		info.Text = "Kh√¥ng t√¨m th·∫•y server ph√π h·ª£p."
		return nil
	end
end

-- N√∫t s·ª± ki·ªán
refreshBtn.MouseButton1Click:Connect(function()
	findBestServer("lowpop")
end)

lowPopBtn.MouseButton1Click:Connect(function()
	local id = findBestServer("lowpop")
	if id then wait(1) TeleportService:TeleportToPlaceInstance(PLACE_ID, id, Players.LocalPlayer) end
end)

lowPingBtn.MouseButton1Click:Connect(function()
	local id = findBestServer("lowping")
	if id then wait(1) TeleportService:TeleportToPlaceInstance(PLACE_ID, id, Players.LocalPlayer) end
end)

-- T·ª± ƒë·ªông t·∫£i server khi m·ªü GUI
task.spawn(function()
	findBestServer("lowpop")
end)